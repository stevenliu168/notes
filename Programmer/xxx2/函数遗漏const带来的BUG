函数遗漏const带来的BUG
日期：2010-10-14 11:39浏览：94评论：0
今天检查代码，发现在一个Get函数中对对象的某个字段赋值，此Get函数的作用是获取对象的所有字段信息，以输出话单。在老代码中的确没有问题，因为对此对象操作只会是单线程，但是在性能优化的多线程改造中，由于此Get函数提取的字段接近100个，非常耗费性能，故而把此对象快速Clone一个，传递给另外一个线程去提取字段输出话单，那么修改是针对的Clone出来的对象，而不是原对象。

 

在Get中修改对象状态，这违反了基本的编码规范，但是代码中的确有人会这么去做，或许是偷懒吧。

 

为了避免一些低级的任意添加代码问题，一定要收紧接口的约束，此处的Get函数就限制为const，就能避免此低级的实现问题。

 

所以接口的限制要尽量严格，约束要体现在方方面面，要让违反约束的要么编译不通过，要么运行时会得到警告，而不仅仅是名字。
